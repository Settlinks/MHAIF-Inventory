<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Inventory | Company Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css">
    <style>
        :root { --brand-color: #0056b3; }
        .header-container { text-align: center; padding: 2rem 0; }
        .company-logo { max-width: 200px; filter: drop-shadow(0px 4px 6px rgba(0,0,0,0.1)); }
        .hidden { display: none; }
        .inventory-card { background: #ffffff; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-top: 20px; }
        
        /* Table Responsive Styles */
        #inventory-list { overflow-x: auto; border: 1px solid #eee; border-radius: 8px; margin-top: 10px; background: white; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background-color: var(--brand-color); color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

    <div class="header-container">
        <img src="https://static.wixstatic.com/media/2dd834_86e3b8f7ade04bd180292345eea5a1c0~mv2.png" class="company-logo">
        <h1>Inventory Control System</h1>
    </div>

    <div id="login-section" class="inventory-card">
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="pin" placeholder="Access PIN">
        <button style="width: 100%;" onclick="loadInventory()">Authorize & Login</button>
    </div>

    <div id="main-section" class="hidden">
        <div id="admin-controls" class="inventory-card" style="background: #f4f7f6;">
            <h3>Register New Item</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <input type="text" id="itemName" placeholder="Item Name">
                <select id="itemCategory">
                    <option value="Storage">Storage</option>
                    <option value="Shipping">Shipping</option>
                    <option value="Quote">Quote</option>
                    <option value="Sale">Sale</option>
                </select>
                <input type="number" id="itemStock" placeholder="Stock Level">
                <input type="number" id="itemPrice" placeholder="Sale Price">
                <input type="number" id="itemCost" placeholder="Unit Cost">
                <select id="itemStatus">
                    <option value="Available">Available</option>
                    <option value="Low Stock">Low Stock</option>
                    <option value="Discontinued">Discontinued</option>
                </select>
                <input type="text" id="itemWeight" placeholder="Weight">
                <input type="text" id="itemSupplier" placeholder="Supplier">
                <button style="grid-column: span 3; background-color: #28a745;" onclick="addItem()">Add to Inventory</button>
            </div>
        </div>

        <div class="inventory-card">
            <div id="inventory-list">
                <p>Loading...</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwoOe699NFAKnVh7BUsKU9mbjZZijmCaHce2zPwU4OgSKL_bIdWTIoxjXZpm2f4fRekKg/exec"; 

        async function apiRequest(action, payload = {}) {
            const auth = {
                username: document.getElementById('username').value,
                pin: document.getElementById('pin').value
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    body: JSON.stringify({ action, auth, payload })
                });
                return await response.json();
            } catch (e) {
                console.error(e);
                return { error: "Connection Failed" };
            }
        }

        async function loadInventory() {
            const data = await apiRequest("READ");
            if (data.error) return alert(data.error);

            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('main-section').classList.remove('hidden');

            let html = `<table><tr><th>ID</th><th>Name</th><th>Category</th><th>Stock</th><th>Price</th><th>Cost</th><th>Status</th><th>Supplier</th><th>Action</th></tr>`;
            data.slice(1).forEach(row => {
                html += `<tr>
                    <td>${row[0]}</td>
                    <td><b>${row[1]}</b></td>
                    <td>${row[2]}</td>
                    <td>${row[3]}</td>
                    <td>$${row[4]}</td>
                    <td>$${row[5]}</td>
                    <td>${row[6]}</td>
                    <td>${row[8]}</td>
                    <td><button style="background:#ff4444; padding: 5px;" onclick="deleteItem('${row[0]}')">Delete</button></td>
                </tr>`;
            });
            document.getElementById('inventory-list').innerHTML = html + "</table>";
        }

        async function addItem() {
            const payload = {
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                stock: document.getElementById('itemStock').value,
                price: document.getElementById('itemPrice').value,
                cost: document.getElementById('itemCost').value,
                status: document.getElementById('itemStatus').value,
                weight: document.getElementById('itemWeight').value,
                supplier: document.getElementById('itemSupplier').value
            };

            const res = await apiRequest("CREATE", payload);
            if (res.status === "Success") {
                loadInventory();
                document.querySelectorAll("#admin-controls input").forEach(i => i.value = "");
            } else {
                alert("Error adding item. Check console.");
            }
        }

        async function deleteItem(id) {
            if(confirm("Delete this item?")) {
                await apiRequest("DELETE", { id });
                loadInventory();
            }
        }
    </script>
</body>
</html>
